<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sonic Crypto Dashboard</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/framer-motion@11/dist/framer-motion.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the logo rain effect */
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { motion, AnimatePresence } = window.FramerMotion;

        // MCP Client for our Worker
        class MCPClient {
            constructor(baseUrl = '') {
                this.baseUrl = baseUrl;
            }

            async callTool(name, arguments_ = {}) {
                try {
                    const response = await fetch(`${this.baseUrl}/mcp/tools/call`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ name, arguments: arguments_ })
                    });
                    return await response.json();
                } catch (error) {
                    console.error(`Failed to call MCP tool ${name}:`, error);
                    return { error: { code: -1, message: error.message } };
                }
            }

            async getLatestPrices(instruments) {
                return this.callTool('get_latest_index_tick', {
                    market: 'cadli',
                    instruments: instruments
                });
            }

            async getLatestMarketReport() {
                return this.callTool('get_latest_market_report', {});
            }

            async searchSonicOpportunities(opportunityTypes) {
                return this.callTool('search_sonic_opportunities', {
                    opportunity_types: opportunityTypes,
                    risk_tolerance: 'medium',
                    min_yield: 10
                });
            }

            async analyzeSentiment(sources) {
                return this.callTool('analyze_sonic_market_sentiment', {
                    sentiment_sources: sources
                });
            }
        }

        const mcpClient = new MCPClient();

        // Logo rain background component
        function LogoRain() {
            const canvasRef = useRef(null);
            const animationRef = useRef(0);
            const dropsRef = useRef([]);

            // Simple logo URLs for the rain effect
            const logoUrls = [
                'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTYiIGZpbGw9IiMzQjgyRjYiLz4KPHRleHQgeD0iMTYiIHk9IjIwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSJ3aGl0ZSIgZm9udC1zaXplPSIxMiI+UzwvdGV4dD4KPC9zdmc+',
                'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTYiIGZpbGw9IiM4QjVDRjYiLz4KPHRleHQgeD0iMTYiIHk9IjIwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSJ3aGl0ZSIgZm9udC1zaXplPSIxMiI+RDwvdGV4dD4KPC9zdmc+',
                'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTYiIGZpbGw9IiMxMEI5ODEiLz4KPHR5eHQgeD0iMTYiIHk9IjIwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSJ3aGl0ZSIgZm9udC1zaXplPSIxMiI+TjwvdGV4dD4KPC9zdmc+'
            ];

            useEffect(() => {
                const canvas = canvasRef.current;
                if (!canvas) return;

                const ctx = canvas.getContext('2d');
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;

                // Create drops
                const createDrop = () => ({
                    x: Math.random() * canvas.width,
                    y: Math.random() * -canvas.height,
                    speed: Math.random() * 2 + 1,
                    size: Math.random() * 30 + 20,
                    logoIndex: Math.floor(Math.random() * logoUrls.length),
                    opacity: Math.random() * 0.5 + 0.3
                });

                // Initialize drops
                for (let i = 0; i < 15; i++) {
                    dropsRef.current.push(createDrop());
                }

                const animate = () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);

                    dropsRef.current.forEach((drop, index) => {
                        // Draw simple colored circles instead of images for simplicity
                        ctx.globalAlpha = drop.opacity;
                        ctx.fillStyle = ['#3B82F6', '#8B5CF6', '#10B981'][drop.logoIndex];
                        ctx.beginPath();
                        ctx.arc(drop.x, drop.y, drop.size / 2, 0, Math.PI * 2);
                        ctx.fill();

                        // Update position
                        drop.y += drop.speed;

                        // Reset drop when it goes off screen
                        if (drop.y > canvas.height + drop.size) {
                            dropsRef.current[index] = createDrop();
                        }
                    });

                    ctx.globalAlpha = 1;
                    animationRef.current = requestAnimationFrame(animate);
                };

                animate();

                const handleResize = () => {
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                };

                window.addEventListener('resize', handleResize);

                return () => {
                    cancelAnimationFrame(animationRef.current);
                    window.removeEventListener('resize', handleResize);
                };
            }, []);

            return React.createElement('canvas', {
                ref: canvasRef,
                className: 'absolute inset-0 w-full h-full pointer-events-none',
                style: { zIndex: 0 }
            });
        }

        // Dashboard component
        function Dashboard() {
            const [showDashboard, setShowDashboard] = useState(false);
            const [latestReport, setLatestReport] = useState(null);
            const [priceData, setPriceData] = useState([]);
            const [loading, setLoading] = useState(false);

            const loadData = async () => {
                setLoading(true);
                try {
                    // Load latest prices
                    const pricesResponse = await mcpClient.getLatestPrices(['S-USD', 'ETH-USD', 'BTC-USD', 'USDC-USD']);

                    if (pricesResponse.result?.data) {
                        const prices = [];
                        const priceDataObj = pricesResponse.result.data;

                        ['S-USD', 'ETH-USD', 'BTC-USD', 'USDC-USD'].forEach(instrument => {
                            if (priceDataObj[instrument]) {
                                const data = priceDataObj[instrument];
                                prices.push({
                                    instrument,
                                    price: data.value || data.close || 0,
                                    change_24h: (data.close - data.open) || 0,
                                    change_percentage_24h: data.open ? ((data.close - data.open) / data.open) * 100 : 0
                                });
                            }
                        });
                        setPriceData(prices);
                    }

                    // Load latest report
                    const reportResponse = await mcpClient.getLatestMarketReport();
                    if (reportResponse.result) {
                        setLatestReport(reportResponse.result);
                    }
                } catch (error) {
                    console.error('Failed to load data:', error);
                    // Fallback data
                    setPriceData([
                        { instrument: 'S-USD', price: 1.125, change_24h: 0.125, change_percentage_24h: 12.5 },
                        { instrument: 'ETH-USD', price: 3456.78, change_24h: -45.22, change_percentage_24h: -1.3 },
                        { instrument: 'BTC-USD', price: 67890.12, change_24h: 1234.56, change_percentage_24h: 1.85 },
                        { instrument: 'USDC-USD', price: 1.001, change_24h: 0.001, change_percentage_24h: 0.1 }
                    ]);
                }
                setLoading(false);
            };

            useEffect(() => {
                if (showDashboard) {
                    loadData();
                    const interval = setInterval(loadData, 30000);
                    return () => clearInterval(interval);
                }
            }, [showDashboard]);

            if (!showDashboard) {
                return React.createElement('div', {
                    className: 'relative min-h-screen w-full flex items-center justify-center overflow-hidden bg-neutral-950'
                }, [
                    React.createElement(LogoRain, { key: 'rain' }),
                    React.createElement('div', {
                        key: 'content',
                        className: 'relative z-10 container mx-auto px-4 text-center'
                    }, [
                        React.createElement(motion.div, {
                            key: 'title',
                            initial: { opacity: 0 },
                            animate: { opacity: 1 },
                            transition: { duration: 2 },
                            className: 'max-w-4xl mx-auto'
                        }, [
                            React.createElement('h1', {
                                key: 'h1',
                                className: 'text-5xl sm:text-7xl md:text-8xl font-bold mb-8 tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-white to-white/80'
                            }, 'Sonic Crypto Dashboard'),
                            React.createElement('button', {
                                key: 'button',
                                onClick: () => setShowDashboard(true),
                                className: 'inline-block group relative bg-gradient-to-b from-white/10 to-white/5 p-px rounded-2xl backdrop-blur-lg overflow-hidden shadow-lg hover:shadow-xl transition-shadow duration-300'
                            }, React.createElement('span', {
                                className: 'block rounded-[1.15rem] px-8 py-6 text-lg font-semibold backdrop-blur-md bg-white/10 hover:bg-white/20 text-white transition-all duration-300 group-hover:-translate-y-0.5 border border-white/20 hover:shadow-md hover:shadow-white/10'
                            }, [
                                React.createElement('span', {
                                    key: 'text',
                                    className: 'opacity-90 group-hover:opacity-100 transition-opacity'
                                }, 'Enter Dashboard'),
                                React.createElement('span', {
                                    key: 'arrow',
                                    className: 'ml-3 opacity-70 group-hover:opacity-100 group-hover:translate-x-1.5 transition-all duration-300'
                                }, '→')
                            ]))
                        ])
                    ])
                ]);
            }

            return React.createElement('div', {
                className: 'relative min-h-screen bg-neutral-950'
            }, [
                React.createElement(LogoRain, { key: 'bg-rain' }),
                React.createElement('div', {
                    key: 'dashboard',
                    className: 'absolute inset-0 z-20 p-6'
                }, [
                    React.createElement('div', {
                        key: 'container',
                        className: 'max-w-7xl mx-auto h-full'
                    }, [
                        // Header
                        React.createElement(motion.div, {
                            key: 'header',
                            initial: { opacity: 0, y: -20 },
                            animate: { opacity: 1, y: 0 },
                            className: 'text-center mb-8'
                        }, [
                            React.createElement('div', {
                                key: 'header-content',
                                className: 'flex items-center justify-center gap-4 mb-4'
                            }, [
                                React.createElement('h1', {
                                    key: 'title',
                                    className: 'text-4xl font-bold text-white'
                                }, 'Sonic Crypto Dashboard'),
                                React.createElement('button', {
                                    key: 'refresh',
                                    onClick: loadData,
                                    disabled: loading,
                                    className: 'text-white hover:bg-white/10 p-2 rounded-lg transition-colors'
                                }, '🔄')
                            ]),
                            React.createElement('p', {
                                key: 'subtitle',
                                className: 'text-white/70'
                            }, 'Real-time market data and AI-powered insights')
                        ]),

                        // Main Grid
                        React.createElement('div', {
                            key: 'grid',
                            className: 'grid grid-cols-1 lg:grid-cols-3 gap-6'
                        }, [
                            // Price Cards
                            ...priceData.map((item, index) =>
                                React.createElement(motion.div, {
                                    key: `price-${item.instrument}`,
                                    initial: { scale: 0, opacity: 0, y: 50 },
                                    animate: { scale: 1, opacity: 1, y: 0 },
                                    transition: { delay: index * 0.1, type: "spring", stiffness: 300, damping: 24 },
                                    whileHover: { scale: 1.02, y: -5 },
                                    className: 'bg-black/40 backdrop-blur-lg border border-white/20 rounded-2xl p-6'
                                }, [
                                    React.createElement('div', {
                                        key: 'price-header',
                                        className: 'flex items-center gap-3 mb-4'
                                    }, [
                                        React.createElement('span', {
                                            key: 'icon',
                                            className: 'w-6 h-6 text-green-400'
                                        }, '📈'),
                                        React.createElement('h2', {
                                            key: 'instrument',
                                            className: 'text-xl font-semibold text-white'
                                        }, item.instrument)
                                    ]),
                                    React.createElement('div', {
                                        key: 'price-data',
                                        className: 'space-y-2'
                                    }, [
                                        React.createElement('div', {
                                            key: 'price',
                                            className: 'text-2xl font-bold text-white'
                                        }, `$${item.price.toLocaleString()}`),
                                        React.createElement('div', {
                                            key: 'change',
                                            className: `text-sm ${item.change_percentage_24h >= 0 ? 'text-green-400' : 'text-red-400'}`
                                        }, `${item.change_percentage_24h >= 0 ? '+' : ''}${item.change_percentage_24h.toFixed(2)}%`)
                                    ])
                                ])
                            ),

                            // Latest Report Card
                            latestReport && React.createElement(motion.div, {
                                key: 'report',
                                initial: { scale: 0, opacity: 0, y: 50 },
                                animate: { scale: 1, opacity: 1, y: 0 },
                                transition: { delay: 0.5, type: "spring", stiffness: 300, damping: 24 },
                                whileHover: { scale: 1.02, y: -5 },
                                className: 'lg:col-span-3 bg-black/40 backdrop-blur-lg border border-white/20 rounded-2xl p-6'
                            }, [
                                React.createElement('div', {
                                    key: 'report-header',
                                    className: 'flex items-center gap-3 mb-4'
                                }, [
                                    React.createElement('span', {
                                        key: 'icon',
                                        className: 'w-6 h-6 text-blue-400'
                                    }, '📄'),
                                    React.createElement('h2', {
                                        key: 'title',
                                        className: 'text-xl font-semibold text-white'
                                    }, 'Latest Market Report'),
                                    React.createElement('span', {
                                        key: 'type',
                                        className: 'px-2 py-1 bg-blue-500/20 text-blue-300 rounded-lg text-sm capitalize'
                                    }, latestReport.type)
                                ]),
                                React.createElement('div', {
                                    key: 'report-content',
                                    className: 'space-y-4'
                                }, [
                                    React.createElement('h3', {
                                        key: 'report-title',
                                        className: 'text-lg font-medium text-white'
                                    }, latestReport.title),
                                    React.createElement('p', {
                                        key: 'summary',
                                        className: 'text-white/80 leading-relaxed'
                                    }, latestReport.executive_summary)
                                ])
                            ])
                        ])
                    ])
                ])
            ]);
        }

        // Render the app
        ReactDOM.render(React.createElement(Dashboard), document.getElementById('root'));
    </script>
</body>
</html>